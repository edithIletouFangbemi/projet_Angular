
<div class="page-wrapper">

  <div class="page-header">
    <div class="row align-items-end">
      <div class="col-lg-8">
        <div class="page-header-title">
          <div class="d-inline">
            <h4>Les Contrats des Institutions</h4>
            <span></span>
          </div>
        </div>
      </div>
      <div class="col-lg-4">
        <div class="page-header-breadcrumb">
          <ul class="breadcrumb-title">
            <li class="breadcrumb-item" style="float: left;">
              <a routerLink="/base/#"> <i class="feather icon-home"></i> </a>
            </li>
            <li class="breadcrumb-item" style="float: left;"><a href="#!">Institution</a>
            </li>
            <li class="breadcrumb-item" style="float: left;"><a href="#!">Gestion des Contrats</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>


  <div class="page-body">
    <div class="card" *ngIf="create == true">
      <div class="card-header"><h5>Nouveau Contrat</h5></div>
      <div class="card-block">
        <form [formGroup]="form">
          <div class="dt-responsive table-responsive">
            <div class="row">
              <div class="col-md-4">
                <label class="col-form-label">Institution
                </label>
              </div>
              <div class="col-md-6">
                  <select class="form-control" formControlName="institution" >
                    <option *ngFor="let inst of listeInstitution" value="{{inst.codeInst}}">{{inst.nomInst}}</option>
                  </select>
              </div>
            </div>

              <div formArrayName="contratUnits">
                <br>
                <h5>Choisir Produit</h5>
                <br>
                <fieldset *ngFor="let item of contratUnits.controls; let i = index" [formGroupName]="i">
                  <!--<legend>{{i+1}}</legend>-->
                  <div >
                    <div>
                      <label class="col-form-label m-b-5">
                      </label>
                      <button type="button" class="btn btn-sm btn-danger f-right" readOnly (click)="RemoveItem(i)"><i class="feather icon-trash-2"></i></button>
                    </div>
                    <div class="row">
                      <div class="col-md-4">
                        <label class="col-form-label">Produit</label>
                        <select class="form-control" formControlName="produit" (click)="getModule(i)">
                            <option *ngFor="let produit of listeProduit" [value]="produit.codeProduit">{{produit.nom}}</option>
                        </select>
                      </div>
                      <div class="col-md-4">
                        <label class="col-form-label">Type Contrat</label>
                        <select class="form-control" formControlName="typeContrat" [(ngModel)]="selectedTypeContrat[i]">
                          <option value="AgenceLimité_PosteLimité">Agence_limité - Poste_limité</option>
                          <option value="AgenceIllimité_PosteIllimité">Agence_illimité - Poste_illimité</option>
                          <option value="AgenceLimité_PosteIllimité">Agence_limité - Poste_illimité</option>
                        </select>
                      </div>
                      <div class="col-md-4">
                        <label class="col-form-label">Date de Début
                        </label>
                        <input type="date" class="form-control" [min]="currentDate | date:'yyyy-MM-dd'" formControlName="dateDebut" [(ngModel)]="anotherDate" required>
                      </div>
                    </div>
                    <div class="row">

                     <div class="col-md-4">
                        <label class="col-form-label" >Date de Fin
                        </label>
                        <input class="form-control" type="date" [min]="currentDate| date: 'yyyy-MM-dd'" formControlName="dateFin" >
                      </div>
                      <div class="col-md-4" *ngIf="selectedTypeContrat[i]=== 'AgenceLimité_PosteLimité' || selectedTypeContrat[i] === 'AgenceLimité_PosteIllimité' ">
                        <label class="col-form-label">Nombre d'Agence
                        </label>
                        <input type="number" class="form-control" (input)="onNameContratInput($event,'nbrAgence')" min="1" formControlName="nbrAgence" [(ngModel)]="numberEntered">
                        <span class="messages"></span>
                      </div>
                      <div class="col-md-4" *ngIf="selectedTypeContrat[i]=== 'AgenceLimité_PosteLimité' ">
                        <label class="col-form-label">Nombre de poste
                        </label>
                        <input type="number" class="form-control" (input)="onNameContratInput($event,'nbrPosteTotal')" min="1" formControlName="nbrPoste" placeholder="nombre de poste ici...">
                        <span class="messages"></span>

                      </div>

                    </div>
                    <div class="row">
                      <div class="col-md-4">
                        <label class="col-form-label">Modules: </label>
                        <select class="form-control" formControlName="modules" multiple="true">
                          <option *ngFor="let module of listeModule" [value]="module.codeModule" (click)="activerPourAgence(module.codeModule)">{{module.libelleModule}}</option>
                        </select>
                      </div>
                      <div class="col-md-4">
                        <label class="col-form-label">Agences: </label>
                        <select class="form-control" [disabled]="(selectedTypeContrat[i]=== 'AgenceLimité_PosteLimité' || selectedTypeContrat[i] === 'AgenceLimité_PosteIllimité') && selectedItems.length >= numberEntered" formControlName="agences" multiple="true" [(ngModel)]="selectedItems" >
                          <option *ngFor="let agence of listeAgence" [value]="agence.codeAgence">{{agence.nom}}</option>
                        </select>
                      </div>

                    </div>


                  </div>
                  <br>
                </fieldset>
                <br>
              </div>

            <div>
            <button type="button" class="btn btn-sm btn-success mt-3"  (click)="CreateItem()"><i class="feather icon-plus "></i></button>
           </div>

           <div class="row">
            <div class="col-md-6"></div>
            <div class="col-md-6">

                <button type="button" class="btn btn-sm btn-success " (click)="newContrat()" >
                  Valider</button>


                <button type="submit" class="btn btn-sm btn-danger m-r-2" (click)="annulerForm()" >
                  <i class="feather icon-arrow-left"></i>
                  Annuler</button>

            </div>

           </div>
          </div>
          <!--
            <div *ngIf="suite == true">
            <div class="form-group row">

            </div>

            <div class="form-group row" >
              <div class="col-md-6" >

              </div>
              <div class="col-md-6" >

              </div>

            </div>
            <button id="edit-btn" type="button" class="btn btn-sm btn-light waves-effect waves-light f-right" (click)="suivant()">Suivant
            <i class="feather icon-arrow-right"></i>
          </button>

            <button type="button" [disabled]="contratForm.invalid" class="btn btn-sm btn-success f-right " (click)="newContrat()" >
              Valider</button>

            <button type="submit" class="btn btn-sm btn-light f-right m-l-2" (click)="suivant()" >
              <i class="feather icon-arrow-left"></i>
              Retour</button>
          </div>
          -->

        </form>

      </div>
    </div>

    <div class="card">
      <div class="card-header">
        <h5>Liste des Contrats</h5>

        <button type="button" [disabled]="listeInstitution.length === 0" class="Plug-right btn btn-grd-inverse m-r-10 m-b-5 float-right" (click)="nouveau()" ><i
            class="feather icon-plus" ></i>
          Nouveau Contrat</button>

      </div>
      <div class="card-block">
        <div class="dt-responsive table-responsive">
          <table id="table-style-hover" class="table table-striped table-hover table-bordered nowrap" *ngIf="listeContrat.length >0">
            <thead>
              <tr>
                <th>Institution</th>
                <th>Nbr de Produit</th>
                <th>Type d'Architecture</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let contrat of listeContrat">
                <td>{{contrat.nomInst}}</td>
                <td>{{contrat.nbrProduit}}</td>
                <td>{{contrat.typeArchitecture}}</td>
                <td>
                  <button class="btn btn-success mr-2" title="details" (click)="details(contrat)">
                    <i class="feather icon-trending-up"></i>
                  </button>


                </td>
              </tr>

            </tbody>
            <tfoot>
              <tr>
                <th>Institution</th>
                <th>Nbr de Produit</th>
                <th>Type d'Architecture</th>
                <th>Actions</th>
              </tr>
            </tfoot>
          </table>
          <div *ngIf="listeContrat.length === 0">
              <p>Liste vide !!</p>
          </div>
        </div>
      </div>
    </div>

  </div>

</div>


<!--modal-->





<!--end modal-->






